function toWeekday(dateString) { const days = ['일', '월', '화', '수', '목', '금', '토']; const date = new Date(dateString); return days[date.getDay()]; } let stream = null; // ✅ stream 전역 선언 (필수) window.addEventListener("DOMContentLoaded", () => { const userNo = localStorage.getItem("user_no"); console.log(userNo); //=> 여기 잘 읽음 if (!userNo) { alert("로그인이 필요합니다"); location.href = "../login/login.html"; return; } const sidebar = document.getElementById("sidebar"); const overlay = document.getElementById("overlay"); const menuBtn = document.getElementById("menuBtn"); const startBtn = document.getElementById("startBtn"); const stopBtn = document.getElementById("stopBtn"); const webcam = document.getElementById("webcam"); if (!sidebar || !overlay || !menuBtn) { console.log("❌ 연결 실패", { sidebar, overlay, menuBtn }); return; } // ============================== // 사이드바 열기/닫기 // ============================== menuBtn.addEventListener("click", () => { sidebar.classList.add("active"); overlay.classList.add("active"); }); overlay.addEventListener("click", () => { sidebar.classList.remove("active"); overlay.classList.remove("active"); }); fetch(http://192.168.219.128:4000/api/dashboard/${userNo}) .then(res => res.json()) .then(data => { if (data.status !== "success") return; // console.log(data); // 1️⃣ 인사말 document.getElementById("helloText").innerText = ${data.name}님 안녕하세요!; const reports = data.reports; // 2️⃣ 날짜 / 점수 분리 //const labels = reports.map(r => r.report_date); const focusData = reports.map(r => r.avg_focus_score); const stressData = reports.map(r => r.avg_stress_score); // 3️⃣ 오늘 점수 (마지막 값) let todayFocus = focusData.at(-1) ?? 0; let todayStress = stressData.at(-1) ?? 0; todayFocus = Number(todayFocus); todayStress = Number(todayStress); const labels = reports.map(item => toWeekday(item.report_date)); console.log(todayStress); document.querySelector(".text-wrapper-13").innerText = ${todayFocus}%; document.querySelector(".text-wrapper-4").innerText = ${todayStress}%; console.log(labels); // 4️⃣ 차트 그리기 drawFocusChart(labels, focusData); drawStressChart(labels, stressData); }); }); function drawFocusChart(labels, data) { new Chart(document.getElementById("monthChart"), { type: "bar", data: { labels, datasets: [{ data, backgroundColor: "#33D6A6", borderRadius: 20, barThickness: 10 }] }, options: chartOptions() }); } function drawStressChart(labels, data) { new Chart(document.getElementById("focusChart"), { type: "bar", data: { labels, datasets: [{ data, backgroundColor: "#FF8A8A", borderRadius: 20, barThickness: 10 }] }, options: chartOptions() }); } function chartOptions() { return { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { min: 0, max: 100, ticks: { stepSize: 50 } } } }; }
